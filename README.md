Codeigniter-Image-Helper
========================

Dynamic Generate an Image Thumbnail.


Example 
--------

<?php
// load Image Lib, it not required if image library is set on ./config/autoload.php

$this->load->library('image_lib');

// retrun image thumbnail path. with Base url.

$thumb_img = image_thumb(array("width" => "200", "height" => "200", "media/image/photo.jpg");

// if base path is not needed then add last parameter false
// ex. image_thumb(array("width"=>"200","height"=>"200","media/image/photo.jpg",false);
// with html helper
// echo img($thumb_img);
// html
// <img src="<?php echo $thumb_img;
?> " alt="" />


<div class="highlight"><pre><div id="LC1" class="line" style="background-color: transparent;"><span class="cp">&lt;?php</span></div><div id="LC2" class="line" style="background-color: transparent;"><br></div><div id="LC3" class="line" style="background-color: transparent;"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="s1">'BASEPATH'</span><span class="p">))</span></div><div id="LC4" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">exit</span><span class="p">(</span><span class="s1">'No direct script access allowed'</span><span class="p">);</span></div><div id="LC5" class="line" style="background-color: transparent;"><br></div><div id="LC6" class="line" style="background-color: transparent;"><span class="sd">/**</span></div><div id="LC7" class="line" style="background-color: transparent;"><span class="sd"> * @author Jayesh Bhalodia {jayeshbhalodia@ymail.com}</span></div><div id="LC8" class="line" style="background-color: transparent;"><span class="sd"> * </span></div><div id="LC9" class="line" style="background-color: transparent;"><span class="sd"> *  image manipulation helper</span></div><div id="LC10" class="line" style="background-color: transparent;"><span class="sd"> *  it should be used for generate dynamic thumbnail with its associated parameters. </span></div><div id="LC11" class="line" style="background-color: transparent;"><span class="sd"> */</span></div><div id="LC12" class="line" style="background-color: transparent;"><br></div><div id="LC13" class="line" style="background-color: transparent;"><span class="sd">/**</span></div><div id="LC14" class="line" style="background-color: transparent;"><span class="sd"> * </span></div><div id="LC15" class="line" style="background-color: transparent;"><span class="sd"> * create thumbnail </span></div><div id="LC16" class="line" style="background-color: transparent;"><span class="sd"> * </span></div><div id="LC17" class="line" style="background-color: transparent;"><span class="sd"> * @author Jayesh Bhalodia</span></div><div id="LC18" class="line" style="background-color: transparent;"><span class="sd"> * @param type $size array like array('width'=&gt;'128','height'=&gt;'128');</span></div><div id="LC19" class="line" style="background-color: transparent;"><span class="sd"> * @param type $file_source original file source path.</span></div><div id="LC20" class="line" style="background-color: transparent;"><span class="sd"> * @see </span></div><div id="LC21" class="line" style="background-color: transparent;"><span class="sd"> *    - image_lib library should be set on autoload.</span></div><div id="LC22" class="line" style="background-color: transparent;"><span class="sd"> *    - gd2 enable on server.</span></div><div id="LC23" class="line" style="background-color: transparent;"><span class="sd"> * @return string file path. </span></div><div id="LC24" class="line" style="background-color: transparent;"><span class="sd"> */</span></div><div id="LC25" class="line" style="background-color: transparent;"><span class="k">function</span> <span class="nf">image_thumb</span><span class="p">(</span><span class="nv">$size</span><span class="p">,</span> <span class="nv">$file_source</span><span class="p">)</span> <span class="p">{</span></div><div id="LC26" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// get master object</span></div><div id="LC27" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$CI</span> <span class="o">=</span> <span class="o">&amp;</span> <span class="nx">get_instance</span><span class="p">();</span></div><div id="LC28" class="line" style="background-color: transparent;"><br></div><div id="LC29" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Image configuration </span></div><div id="LC30" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$config</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span></div><div id="LC31" class="line" style="background-color: transparent;"><br></div><div id="LC32" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$file_path_explode</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nv">$file_source</span><span class="p">);</span></div><div id="LC33" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$file_name</span> <span class="o">=</span> <span class="nb">end</span><span class="p">(</span><span class="nv">$file_path_explode</span><span class="p">);</span></div><div id="LC34" class="line" style="background-color: transparent;"><br></div><div id="LC35" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// remove last element of array</span></div><div id="LC36" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">array_pop</span><span class="p">(</span><span class="nv">$file_path_explode</span><span class="p">);</span></div><div id="LC37" class="line" style="background-color: transparent;"><br></div><div id="LC38" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$new_direct_path</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nv">$file_path_explode</span><span class="p">);</span></div><div id="LC39" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$new_direct_path</span> <span class="o">.=</span> <span class="s1">'/'</span> <span class="o">.</span> <span class="nv">$size</span><span class="p">[</span><span class="s1">'width'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'x'</span> <span class="o">.</span> <span class="nv">$size</span><span class="p">[</span><span class="s1">'height'</span><span class="p">];</span></div><div id="LC40" class="line" style="background-color: transparent;"><br></div><div id="LC41" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$file_path</span> <span class="o">=</span> <span class="nv">$new_direct_path</span> <span class="o">.</span> <span class="s1">'/'</span> <span class="o">.</span> <span class="nv">$file_name</span><span class="p">;</span></div><div id="LC42" class="line" style="background-color: transparent;"><br></div><div id="LC43" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// if file has been exists then directly return that path.</span></div><div id="LC44" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">))</span> <span class="p">{</span></div><div id="LC45" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nv">$file_path</span><span class="p">;</span></div><div id="LC46" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div id="LC47" class="line" style="background-color: transparent;"><br></div><div id="LC48" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// create directory if not exists</span></div><div id="LC49" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// directory name would be (widht)x(height) ex. 128x128</span></div><div id="LC50" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$new_direct_path</span><span class="p">))</span> <span class="p">{</span></div><div id="LC51" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">mkdir</span><span class="p">(</span><span class="nv">$new_direct_path</span><span class="p">))</span> <span class="p">{</span></div><div id="LC52" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">ENVIRONMENT</span> <span class="o">==</span> <span class="s1">'dev'</span><span class="p">)</span> <span class="p">{</span></div><div id="LC53" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">exit</span><span class="p">(</span><span class="s1">'directory create permission is denied !'</span><span class="p">);</span></div><div id="LC54" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div id="LC55" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// exit(0);</span></div><div id="LC56" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div id="LC57" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div id="LC58" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div id="LC59" class="line" style="background-color: transparent;"><br></div><div id="LC60" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// set image configuration.</span></div><div id="LC61" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$config</span><span class="p">[</span><span class="s1">'image_library'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'gd2'</span><span class="p">;</span></div><div id="LC62" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$config</span><span class="p">[</span><span class="s1">'source_image'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$file_source</span><span class="p">;</span></div><div id="LC63" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$config</span><span class="p">[</span><span class="s1">'create_thumb'</span><span class="p">]</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span></div><div id="LC64" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$config</span><span class="p">[</span><span class="s1">'maintain_ratio'</span><span class="p">]</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span></div><div id="LC65" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$config</span><span class="p">[</span><span class="s1">'new_image'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$file_path</span><span class="p">;</span></div><div id="LC66" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$config</span><span class="p">[</span><span class="s1">'thumb_marker'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span></div><div id="LC67" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$config</span><span class="p">[</span><span class="s1">'quality'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'100%'</span><span class="p">;</span></div><div id="LC68" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$config</span><span class="p">[</span><span class="s1">'width'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$size</span><span class="p">[</span><span class="s1">'width'</span><span class="p">];</span></div><div id="LC69" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$config</span><span class="p">[</span><span class="s1">'height'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$size</span><span class="p">[</span><span class="s1">'height'</span><span class="p">];</span></div><div id="LC70" class="line" style="background-color: transparent;"><br></div><div id="LC71" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// init a configuration of image</span></div><div id="LC72" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$CI</span><span class="o">-&gt;</span><span class="na">image_lib</span><span class="o">-&gt;</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span></div><div id="LC73" class="line" style="background-color: transparent;"><br></div><div id="LC74" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$CI</span><span class="o">-&gt;</span><span class="na">image_lib</span><span class="o">-&gt;</span><span class="na">resize</span><span class="p">())</span> <span class="p">{</span></div><div id="LC75" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">echo</span> <span class="nv">$CI</span><span class="o">-&gt;</span><span class="na">image_lib</span><span class="o">-&gt;</span><span class="na">display_errors</span><span class="p">();</span></div><div id="LC76" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div id="LC77" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nv">$file_path</span><span class="p">;</span></div><div id="LC78" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div id="LC79" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// clear last configuration.</span></div><div id="LC80" class="line" style="background-color: transparent;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">$CI</span><span class="o">-&gt;</span><span class="na">image_lib</span><span class="o">-&gt;</span><span class="na">clear</span><span class="p">();</span></div><div id="LC81" class="line" style="background-color: transparent;"><span class="p">}</span></div></pre></div>